{"version":3,"file":"indicia.js","sources":["../node_modules/@babel/runtime/helpers/typeof.js","../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../src/Store.js","../node_modules/@babel/runtime/helpers/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/nonIterableRest.js","../node_modules/@babel/runtime/helpers/slicedToArray.js","../src/Collection.js","../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/iterableToArray.js","../node_modules/@babel/runtime/helpers/nonIterableSpread.js","../node_modules/@babel/runtime/helpers/toConsumableArray.js","../src/constants.js","../src/helpers.js","../src/sync_helpers.js","../src/Media.js","../src/Occurrence.js","../src/Sample.js","../src/Report.js","../src/main.js"],"sourcesContent":["function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","import Backbone from 'backbone';\nimport LocalForage from 'localforage';\nimport _ from 'underscore';\n\n/*!\n Inspired by localForage Backbone Adapter\n */\n\n// For now, we aren't complicated: just set a property off Backbone to\n// serve as our export point.\nclass Store {\n  constructor(options = {}) {\n    const that = this;\n\n    // initialize db\n    this.localForage = null;\n    this.ready = new Promise((resolve, reject) => {\n      // check custom drivers (eg. SQLite)\n      const customDriversPromise = new Promise(_resolve => {\n        if (options.driverOrder && typeof options.driverOrder[0] === 'object') {\n          LocalForage.defineDriver(options.driverOrder[0]).then(_resolve);\n        } else {\n          _resolve();\n        }\n      });\n\n      // config\n      customDriversPromise.then(() => {\n        const dbConfig = {\n          name: options.name || 'indicia',\n          storeName: options.storeName || 'models',\n        };\n\n        if (options.version) {\n          dbConfig.version = options.version;\n        }\n\n        const driverOrder = options.driverOrder || [\n          'indexeddb',\n          'websql',\n          'localstorage',\n        ];\n        const drivers = Store._getDriverOrder(driverOrder);\n        const DB = options.LocalForage || LocalForage;\n\n        // init\n        that.localForage = DB.createInstance(dbConfig);\n        that.localForage\n          .setDriver(drivers)\n          .then(() => {\n            resolve(that.localForage);\n          })\n          .catch(reject);\n      });\n    });\n  }\n\n  static _getDriverOrder(driverOrder) {\n    return driverOrder.map(driver => {\n      switch (driver) {\n        case 'indexeddb':\n          return LocalForage.INDEXEDDB;\n        case 'websql':\n          return LocalForage.WEBSQL;\n        case 'localstorage':\n          return LocalForage.LOCALSTORAGE;\n        default:\n          // custom\n          if (typeof driver === 'object' && driver._driver) {\n            return driver._driver;\n          }\n          return console.error('No such db driver!');\n      }\n    });\n  }\n\n  sync(method, model, options) {\n    switch (method) {\n      case 'read':\n        return model.cid\n          ? this.find(model, options)\n          : this.findAll(model, options);\n      case 'create':\n        return this.create(model, options);\n      case 'update':\n        return this.update(model, options);\n      case 'delete':\n        return this.destroy(model, options);\n      default:\n        return Promise.reject(\n          new Error(`Local Sync method not found ${method}`)\n        );\n    }\n  }\n\n  save(model, options) {\n    return this._callWhenReady(() => {\n      // save collection\n      if (model instanceof Backbone.Collection) {\n        if (!model.models.length) {\n          return Promise.resolve();\n        }\n\n        const toWait = [];\n        _.each(model.models, collectionModel => {\n          if (collectionModel.store) {\n            toWait.push(collectionModel.save(null, options));\n          }\n        });\n        return Promise.all(toWait);\n      }\n\n      // early return if no id or cid\n      if (!model.id && !model.cid) {\n        return Promise.reject(new Error('Invalid model passed to store'));\n      }\n\n      const key = model.cid;\n      return this.localForage\n        .setItem(key, model.toJSON())\n        .then(() => Promise.resolve()); // don't return anything to update the model\n    });\n  }\n\n  create(model, options) {\n    // We always have an ID available by this point, so we just call\n    // the update method.\n    return this.update(model, options);\n  }\n\n  update(model, options) {\n    return this.save(model, options);\n  }\n\n  find(model) {\n    return this._callWhenReady(() =>\n      // eslint-disable-line\n      this.localForage.getItem(model.cid).then(data => {\n        if (!data) {\n          return Promise.reject(\n            `LocalForage entry with ${model.cid} as key not found`\n          );\n        }\n        return data;\n      })\n    );\n  }\n\n  // Only used by `Backbone.Collection#sync`.\n  findAll() {\n    return this._callWhenReady(() => {\n      // build up samples\n      const models = [];\n      return this.localForage\n        .iterate(value => {\n          models.push(value);\n        })\n        .then(() => Promise.resolve(models));\n    });\n  }\n\n  destroy(model) {\n    return this._callWhenReady(() => {\n      // collection destroy\n      if (model instanceof Backbone.Collection) {\n        if (!model.models.length) {\n          return Promise.resolve();\n        }\n\n        const toWait = [];\n        // need to clone:\n        // http://stackoverflow.com/questions/10858935/cleanest-way-to-destroy-every-model-in-a-collection-in-backbone\n        _.each(_.clone(model.models), collectionModel => {\n          if (collectionModel.store) toWait.push(collectionModel.destroy());\n        });\n        return Promise.all(toWait);\n      }\n\n      // early return if no id or cid\n      if (!model.id && !model.cid) {\n        return Promise.reject(new Error('Invalid model passed to store'));\n      }\n\n      const key = model.cid;\n      return this.localForage\n        .removeItem(key)\n        .then(() => Promise.resolve(model.toJSON()));\n    });\n  }\n\n  _callWhenReady(func) {\n    const that = this;\n    return this.ready.then(() => func.bind(that)());\n  }\n}\n\nexport default Store;\n","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nmodule.exports = _nonIterableRest;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","/** *********************************************************************\n * COLLECTION MODULE\n **********************************************************************/\nimport Backbone from 'backbone';\nimport _ from 'underscore';\nimport Store from './Store';\n\nconst Collection = Backbone.Collection.extend({\n  constructor(attributes = {}, options = {}) {\n    this.store = options.store || this.store || new Store();\n\n    if (!options.model && !this.model) {\n      console.error(\"Collection's model must be provided\");\n      return;\n    }\n\n    Backbone.Collection.prototype.constructor.apply(this, arguments);\n  },\n\n  comparator(a) {\n    return a.metadata.created_on;\n  },\n\n  size() {\n    return Promise.resolve(this.length);\n  },\n\n  /**\n   * New function to save all models within the collection.\n   * @param models\n   * @param options\n   */\n  save(collection, options) {\n    return this.sync('create', collection || this, options);\n  },\n\n  /**\n   * New function to destroy all models within the collection.\n   * @returns {*}\n   */\n  destroy(collection, options) {\n    return this.sync('delete', collection || this, options);\n  },\n\n  /**\n   * New function to fetch all models within the collection.\n   * @returns {*}\n   */\n  fetch(options) {\n    options = _.extend({ parse: true }, options);\n    const collection = this;\n\n    return this.sync('read', this, options).then(resp => {\n      const method = options.reset ? 'reset' : 'set';\n\n      collection[method](resp, options);\n      try {\n        collection.trigger('sync', collection, resp, options);\n      } catch (e) {\n        /* continue on listener error */\n      }\n    });\n  },\n\n  /**\n   * Synchronises the collection.\n   * @param method\n   * @param model\n   * @param options\n   */\n  sync(method, collection, options = {}) {\n    if (options.remote) {\n      return this._syncRemote(method, collection, options);\n    }\n\n    if (!this.store) {\n      return Promise.reject(\n        new Error('Trying to locally sync a collection without a store')\n      );\n    }\n\n    try {\n      this.trigger('request', collection, null, options);\n    } catch (e) {\n      /* continue on listener error */\n    }\n    return this.store.sync(method, collection, options);\n  },\n\n  /**\n   * Syncs the collection to the remote server.\n   * Returns on success: model, response, options\n   */\n  _syncRemote(method, collection, options) {\n    collection.synchronising = true;\n\n    // model.trigger('request', model, xhr, options);\n    switch (method) {\n      case 'create': {\n        if (!collection.models.length) {\n          return Promise.resolve();\n        }\n        const toWait = [];\n        _.each(collection.models, model => {\n          if (model.store) toWait.push(model.save(null, options));\n        });\n        return Promise.all(toWait);\n      }\n      case 'update':\n        // todo\n        collection.synchronising = false;\n        return Promise.reject(\n          new Error('Updating the model is not possible yet.')\n        );\n\n      case 'read':\n        // todo\n        collection.synchronising = false;\n        return Promise.reject(\n          new Error('Reading the model is not possible yet.')\n        );\n\n      case 'delete':\n        // todo\n        collection.synchronising = false;\n        return Promise.reject(\n          new Error('Deleting the model is not possible yet.')\n        );\n\n      default:\n        collection.synchronising = false;\n        return Promise.reject(\n          new Error(`No such remote sync option: ${method}`)\n        );\n    }\n  },\n\n  /**\n   * Returns an object with attributes and their values\n   * mapped for warehouse submission.\n   *\n   * @returns {*}\n   */\n  _getSubmission(options) {\n    const submission = [];\n    let media = [];\n\n    // transform its models\n    this.models.forEach(model => {\n      const [modelSubmission, modelMedia] = model._getSubmission(options);\n      submission.push(modelSubmission);\n      media = media.concat(modelMedia);\n    });\n\n    return [submission, media];\n  },\n\n  // Prepare a hash of attributes (or other model) to be added to this\n  // collection.\n  _prepareModel(options) {\n    if (this._isModel(options)) {\n      if (!options.collection) options.collection = this;\n      return options;\n    }\n\n    const attrs = options.attributes;\n\n    options = options ? _.clone(options) : {};\n    options.collection = this;\n    options.store = this.store;\n    const model = new this.model(attrs, options); // eslint-disable-line\n    if (!model.validationError) return model;\n    this.trigger('invalid', this, model.validationError, options);\n    return false;\n  },\n});\n\nexport { Collection as default };\n","function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nmodule.exports = _nonIterableSpread;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","/* eslint-disable */\nexport const API_BASE = 'api/',\n  API_VER = 'v1',\n  API_SAMPLES_PATH = '/samples',\n  API_REPORTS_PATH = '/reports',\n  SYNCHRONISING = 0,\n  SYNCED = 1,\n  LOCAL = 2,\n  SERVER = 3,\n  CHANGED_LOCALLY = 4,\n  CHANGED_SERVER = 5,\n  CONFLICT = -1;\n","/** *********************************************************************\n * HELPER FUNCTIONS\n **********************************************************************/\n\n/**\n * Generate UUID.\n */\n/* eslint-disable no-bitwise */\nconst getNewUUID = () =>\n  'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n\n    return v.toString(16);\n  });\n/* eslint-enable no-bitwise */\n\n/**\n * Converts DataURI object to a Blob.\n *\n * @param {type} dataURI\n * @param {type} fileType\n * @returns {undefined}\n */\nconst dataURItoBlob = (dataURI, fileType) => {\n  const binary = atob(dataURI.split(',')[1]);\n  const array = [];\n  for (let i = 0; i < binary.length; i++) {\n    array.push(binary.charCodeAt(i));\n  }\n  return new Blob([new Uint8Array(array)], {\n    type: fileType,\n  });\n};\n\n// Detecting data URLs\n// https://gist.github.com/bgrins/6194623\n\n// data URI - MDN https://developer.mozilla.org/en-US/docs/data_URIs\n// The 'data' URL scheme: http://tools.ietf.org/html/rfc2397\n// Valid URL Characters: http://tools.ietf.org/html/rfc2396#section2\nconst isDataURL = string => {\n  if (!string) {\n    return false;\n  }\n  const normalized = string.toString(); // numbers\n\n  /* eslint-disable no-useless-escape, max-len */\n  const regex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;\n  return !!normalized.match(regex);\n};\n/* eslint-enable no-useless-escape, max-len  */\n\n// From jQuery 1.4.4 .\n/* eslint-disable */\nconst isPlainObject = obj => {\n  function type(obj) {\n    const class2type = {};\n    const types = 'Boolean Number String Function Array Date RegExp Object'.split(\n      ' '\n    );\n    for (let i = 0; i < types.length; i++) {\n      class2type[`[object ${types[i]}]`] = types[i].toLowerCase();\n    }\n    return obj == null\n      ? String(obj)\n      : class2type[toString.call(obj)] || 'object';\n  }\n\n  function isWindow(obj) {\n    return obj && typeof obj === 'object' && 'setInterval' in obj;\n  }\n\n  // Must be an Object.\n  // Because of IE, we also have to check the presence of the constructor property.\n  // Make sure that DOM nodes and window objects don't pass through, as well\n  if (!obj || type(obj) !== 'object' || obj.nodeType || isWindow(obj)) {\n    return false;\n  }\n\n  // Not own constructor property must be Object\n  if (\n    obj.constructor &&\n    !hasOwn.call(obj, 'constructor') &&\n    !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')\n  ) {\n    return false;\n  }\n\n  // Own properties are enumerated firstly, so to speed up,\n  // if last one is own, then all properties are own.\n\n  let key;\n  for (key in obj) {\n  }\n\n  return key === undefined || hasOwn.call(obj, key);\n};\n\n// checks if the object has any elements.\nconst isEmptyObject = obj => {\n  for (const key in obj) {\n    return false;\n  }\n  return true;\n};\n/* eslint-enable */\n\n/**\n * Formats the date to Indicia Warehouse format.\n * @param date String or Date object\n * @returns String formatted date\n */\nconst formatDate = dateToFormat => {\n  let date = dateToFormat;\n  let now = new Date();\n  let day = 0;\n  let month = 0;\n  const reg = /\\d{2}\\/\\d{2}\\/\\d{4}$/;\n  const regDash = /\\d{4}-\\d{1,2}-\\d{1,2}$/;\n  const regDashInv = /\\d{1,2}-\\d{1,2}-\\d{4}$/;\n  let dateArray = [];\n\n  if (typeof date === 'string') {\n    dateArray = date.split('-');\n    // check if valid\n    if (reg.test(date)) {\n      return date;\n      // dashed\n    } else if (regDash.test(date)) {\n      date = new Date(\n        window.parseInt(dateArray[0]),\n        window.parseInt(dateArray[1]) - 1,\n        window.parseInt(dateArray[2])\n      );\n      // inversed dashed\n    } else if (regDashInv.test(date)) {\n      date = new Date(\n        window.parseInt(dateArray[2]),\n        window.parseInt(dateArray[1]) - 1,\n        window.parseInt(dateArray[0])\n      );\n    }\n  }\n\n  now = date || now;\n  day = `0${now.getDate()}`.slice(-2);\n  month = `0${now.getMonth() + 1}`.slice(-2);\n\n  return `${day}/${month}/${now.getFullYear()}`;\n};\n\nexport default {\n  getNewUUID,\n  dataURItoBlob,\n  isDataURL,\n  isPlainObject,\n  isEmptyObject,\n  formatDate,\n};\n","import _ from 'underscore';\n\nconst helpers = {\n  save(key, val, options) {\n    const model = this;\n\n    // Handle both `\"key\", value` and `{key: value}` -style arguments.\n    let attrs;\n    if (key == null || typeof key === 'object') {\n      attrs = key;\n      options = val;\n    } else {\n      (attrs = {})[key] = val;\n    }\n\n    options = _.extend({ validate: true, parse: true }, options);\n    const wait = options.wait;\n\n    // If we're not waiting and attributes exist, save acts as\n    // `set(attr).save(null, opts)` with validation. Otherwise, check if\n    // the model will be valid when the attributes, if any, are set.\n    if (attrs && !wait) {\n      if (!this.set(attrs, options)) return false;\n    } else if (!this._validate(attrs, options)) {\n      return false;\n    }\n\n    // After a successful server-side save, the client is (optionally)\n    // updated with the server-side state.\n    const attributes = model.attributes;\n\n    // Set temporary attributes if `{wait: true}` to properly find new ids.\n    if (attrs && wait) model.attributes = _.extend({}, attributes, attrs);\n\n    let method = 'create';\n    if (!model.isNew() && options.remote) {\n      method = options.patch ? 'patch' : 'update';\n    }\n    if (method === 'patch' && !options.attrs) options.attrs = attrs;\n\n    // parent save\n    if (model.parent && !options.remote) {\n      return model.parent\n        .save(key, val, options)\n        .then(() => {\n          // Ensure attributes are restored during synchronous saves.\n          model.attributes = attributes;\n          try {\n            model.trigger('sync', model, null, options);\n          } catch (e) {\n            /* continue on listener error */\n          }\n          return model;\n        })\n        .catch(err => {\n          try {\n            model.trigger('error', err);\n          } catch (e) {\n            /* continue on listener error */\n          }\n          return Promise.reject(err);\n        });\n    }\n\n    // model save\n    return model\n      .sync(method, model, options)\n      .then(resp => {\n        if (options.remote) {\n          // update the model and occurrences with new remote IDs\n          model._remoteCreateParse(model, resp.data);\n\n          // update metadata\n          const timeNow = new Date();\n          model.metadata.server_on = timeNow;\n          model.metadata.updated_on = timeNow;\n          model.metadata.synced_on = timeNow;\n\n          // Ensure attributes are restored during synchronous saves.\n          model.attributes = attributes;\n\n          // save model's changes locally\n          return model.save().then(() => {\n            try {\n              model.trigger('sync:remote', model, resp, options);\n            } catch (e) {\n              /* continue on listener error */\n            }\n            return model;\n          });\n        }\n\n        try {\n          model.trigger('sync', model, resp, options);\n        } catch (e) {\n          /* continue on listener error */\n        }\n        return model;\n      })\n      .catch(err => {\n        try {\n          model.trigger('error', err);\n        } catch (e) {\n          /* continue on listener error */\n        }\n        return Promise.reject(err);\n      });\n  },\n\n  /**\n   *\n   * @param options\n   * @returns {Promise}\n   */\n  destroy(options = {}) {\n    const model = this;\n    const collection = this.collection; // keep reference for triggering\n\n    const promise = new Promise((fulfill, reject) => {\n      function finalise() {\n        // removes from all collections etc\n        model.stopListening();\n        try {\n          model.trigger('destroy', model, collection, options);\n        } catch (e) {\n          /* continue on listener error */\n        }\n\n        if (!options.noSave) {\n          // parent save the changes permanently\n          model.parent.save(null, options).then(() => {\n            try {\n              model.trigger('sync', model, null, options);\n            } catch (e) {\n              /* continue on listener error */\n            }\n            fulfill(model);\n          });\n        } else {\n          try {\n            model.trigger('sync', model, null, options);\n          } catch (e) {\n            /* continue on listener error */\n          }\n          fulfill(model);\n        }\n      }\n\n      if (model.parent) {\n        if (options.remote) {\n          // destroy remotely\n          model.sync('delete', model, options).then(finalise);\n        } else {\n          finalise();\n        }\n      } else {\n        // destroy locally/remotely\n        model\n          .sync('delete', model, options)\n          .then(() => {\n            // removes from all collections etc\n            model.stopListening();\n            try {\n              model.trigger('destroy', model, collection, options);\n            } catch (e) {\n              /* continue on listener error */\n            }\n            try {\n              model.trigger('sync', model, null, options);\n            } catch (e) {\n              /* continue on listener error */\n            }\n\n            fulfill(model);\n          })\n          .catch(reject);\n      }\n    });\n\n    return promise;\n  },\n};\n\nexport default helpers;\n","/** *********************************************************************\n * IMAGE\n **********************************************************************/\nimport Backbone from 'backbone';\nimport _ from 'underscore';\n\nimport helpers from './helpers';\nimport syncHelpers from './sync_helpers';\n\nconst THUMBNAIL_WIDTH = 100; // px\nconst THUMBNAIL_HEIGHT = 100; // px\n\nconst Media = Backbone.Model.extend({\n  constructor(attributes = {}, options = {}) {\n    let attrs = attributes;\n    if (typeof attributes === 'string') {\n      const data = attributes;\n      attrs = { data };\n      return;\n    }\n\n    this.id = options.id; // remote ID\n    this.cid = options.cid || helpers.getNewUUID();\n    this.setParent(options.parent || this.parent);\n\n    this.attributes = {};\n    if (options.collection) this.collection = options.collection;\n    if (options.parse) attrs = this.parse(attrs, options) || {};\n    attrs = _.defaults({}, attrs, _.result(this, 'defaults'));\n    this.set(attrs, options);\n    this.changed = {};\n\n    if (options.metadata) {\n      this.metadata = options.metadata;\n    } else {\n      this.metadata = {\n        created_on: new Date(),\n      };\n    }\n\n    this.initialize.apply(this, arguments); // eslint-disable-line\n  },\n\n  /**\n   * Synchronises the model.\n   * @param method\n   * @param model\n   * @param options\n   */\n  sync(method, model, options = {}) {\n    if (options.remote) {\n      return this._syncRemote(method, model, options);\n    }\n\n    return Promise.reject(new Error('Local sync is not possible yet.'));\n  },\n\n  /**\n   * Syncs the record to the remote server.\n   * Returns on success: model, response, options\n   */\n  _syncRemote() {\n    return Promise.reject(new Error('Remote sync is not possible yet.'));\n  },\n\n  /**\n   * Returns image's absolute URL or dataURI.\n   */\n  getURL() {\n    return this.get('data');\n  },\n\n  /**\n   * Sets parent.\n   * @param parent\n   */\n  setParent(parent) {\n    if (!parent) return;\n\n    const that = this;\n    this.parent = parent;\n    this.parent.on('destroy', () => {\n      that.destroy({ noSave: true });\n    });\n  },\n\n  /**\n   * Resizes itself.\n   */\n  resize(MAX_WIDTH, MAX_HEIGHT) {\n    const that = this;\n    const promise = new Promise((fulfill, reject) => {\n      Media.resize(this.getURL(), this.get('type'), MAX_WIDTH, MAX_HEIGHT)\n        .then(args => {\n          const [image, data] = args;\n          that.set('data', data);\n          fulfill([image, data]);\n        })\n        .catch(reject);\n    });\n    return promise;\n  },\n\n  /**\n   * Adds a thumbnail to image model.\n   * @param options\n   */\n  addThumbnail(options = {}) {\n    const that = this;\n\n    const promise = new Promise((fulfill, reject) => {\n      // check if data source is dataURI\n      const re = /^data:/i;\n      if (re.test(this.getURL())) {\n        Media.resize(\n          this.getURL(),\n          this.get('type'),\n          THUMBNAIL_WIDTH || options.width,\n          THUMBNAIL_WIDTH || options.width\n        )\n          .then(args => {\n            const [, data] = args;\n            that.set('thumbnail', data);\n            fulfill();\n          })\n          .catch(reject);\n        return;\n      }\n\n      Media.getDataURI(this.getURL(), {\n        width: THUMBNAIL_WIDTH || options.width,\n        height: THUMBNAIL_HEIGHT || options.height,\n      })\n        .then(data => {\n          that.set('thumbnail', data[0]);\n          fulfill();\n        })\n        .catch(reject);\n    });\n\n    return promise;\n  },\n\n  // overwrite if you want to validate before saving remotely\n  validate(attributes, options = {}) {\n    if (options.remote) {\n      return this.validateRemote(attributes, options);\n    }\n    return null;\n  },\n\n  validateRemote(attributes) {\n    const attrs = _.extend({}, this.attributes, attributes);\n    const errors = {};\n\n    // type\n    if (!attrs.data) {\n      errors.attributes || (errors.attributes = {});\n      errors.attributes.data = \"can't be empty\";\n    }\n\n    if (!attrs.type) {\n      errors.attributes || (errors.attributes = {});\n      errors.attributes.type = \"can't be empty\";\n    }\n\n    if (!_.isEmpty(errors)) {\n      return errors;\n    }\n\n    return null;\n  },\n\n  toJSON() {\n    const data = {\n      id: this.id,\n      cid: this.cid,\n      metadata: this.metadata,\n      attributes: this.attributes,\n    };\n    return data;\n  },\n\n  /**\n   * Returns an object with attributes and their values\n   * mapped for warehouse submission.\n   *\n   * @returns {*}\n   */\n  _getSubmission() {\n    const submission = {\n      id: this.id,\n      name: this.cid,\n    };\n\n    return [submission];\n  },\n});\n\n_.extend(Media.prototype, syncHelpers);\n\n_.extend(Media, {\n  /**\n   * Transforms and resizes an image file into a string.\n   * Can accept file image path and a file input file.\n   *\n   * @param onError\n   * @param file\n   * @param onSaveSuccess\n   * @returns {number}\n   */\n  getDataURI(file, options = {}) {\n    const promise = new Promise((fulfill, reject) => {\n      // file paths\n      if (typeof file === 'string') {\n        // get extension\n        let fileType = file.replace(/.*\\.([a-z]+)$/i, '$1');\n        if (fileType === 'jpg') fileType = 'jpeg'; // to match media types image/jpeg\n\n        Media.resize(file, fileType, options.width, options.height).then(\n          args => {\n            const [image, dataURI] = args;\n            fulfill([dataURI, fileType, image.width, image.height]);\n          }\n        );\n        return;\n      }\n\n      // file inputs\n      if (!window.FileReader) {\n        reject(new Error('No File Reader'));\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = function(event) {\n        if (options.width || options.height) {\n          // resize\n          Media.resize(\n            event.target.result,\n            file.type,\n            options.width,\n            options.height\n          ).then(args => {\n            const [image, dataURI] = args;\n            fulfill([dataURI, file.type, image.width, image.height]);\n          });\n        } else {\n          const image = new window.Image(); // native one\n\n          image.onload = () => {\n            const type = file.type.replace(/.*\\/([a-z]+)$/i, '$1');\n            fulfill([event.target.result, type, image.width, image.height]);\n          };\n          image.src = event.target.result;\n        }\n      };\n      reader.readAsDataURL(file);\n    });\n\n    return promise;\n  },\n\n  /**\n   * http://stackoverflow.com/questions/2516117/how-to-scale-an-image-in-data-uri-format-in-javascript-real-scaling-not-usin\n   * @param data\n   * @param fileType\n   * @param MAX_WIDTH\n   * @param MAX_HEIGHT\n   */\n  resize(data, fileType, MAX_WIDTH, MAX_HEIGHT) {\n    const promise = new Promise(fulfill => {\n      const image = new window.Image(); // native one\n\n      image.onload = () => {\n        let width = image.width;\n        let height = image.height;\n        const maxWidth = MAX_WIDTH || width;\n        const maxHeight = MAX_HEIGHT || height;\n\n        let res = null;\n\n        // resizing\n        if (width > height) {\n          res = width / maxWidth;\n        } else {\n          res = height / maxHeight;\n        }\n\n        width /= res;\n        height /= res;\n\n        // Create a canvas with the desired dimensions\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n\n        // Scale and draw the source image to the canvas\n        canvas.getContext('2d').drawImage(image, 0, 0, width, height);\n\n        // Convert the canvas to a data URL in some format\n        fulfill([image, canvas.toDataURL(fileType)]);\n      };\n\n      image.src = data;\n    });\n\n    return promise;\n  },\n});\n\nexport { Media as default };\n","/** *********************************************************************\n * OCCURRENCE\n **********************************************************************/\nimport Backbone from 'backbone';\nimport _ from 'underscore';\nimport $ from 'jquery';\nimport helpers from './helpers';\nimport syncHelpers from './sync_helpers';\nimport Media from './Media';\nimport Collection from './Collection';\n\nconst Occurrence = Backbone.Model.extend({\n  Media,\n\n  constructor(attributes = {}, options = {}) {\n    const that = this;\n    let attrs = attributes;\n\n    this.id = options.id; // remote ID\n    this.cid = options.cid || helpers.getNewUUID();\n    this.setParent(options.parent || this.parent);\n\n    this.keys = options.keys || this.keys; // warehouse attribute keys\n\n    if (options.Media) this.Media = options.Media;\n\n    this.attributes = {};\n    if (options.collection) this.collection = options.collection;\n    if (options.parse) attrs = this.parse(attrs, options) || {};\n    attrs = _.defaults({}, attrs, _.result(this, 'defaults'));\n    this.set(attrs, options);\n    this.changed = {};\n\n    this.metadata = this._getDefaultMetadata(options);\n\n    if (options.media) {\n      const mediaArray = [];\n      _.each(options.media, media => {\n        if (media instanceof this.Media) {\n          media.setParent(that);\n          mediaArray.push(media);\n        } else {\n          const modelOptions = _.extend(media, { parent: that });\n          mediaArray.push(new this.Media(media.attributes, modelOptions));\n        }\n      });\n      this.media = new Collection(mediaArray, {\n        model: this.Media,\n      });\n    } else {\n      this.media = new Collection([], {\n        model: this.Media,\n      });\n    }\n\n    this.initialize.apply(this, arguments); // eslint-disable-line\n  },\n\n  /**\n   * Sets parent.\n   * todo: move to private _space\n   * @param parent\n   */\n  setParent(parent) {\n    if (!parent) return;\n\n    const that = this;\n    this.parent = parent;\n    this.parent.on('destroy', () => {\n      that.destroy({ noSave: true });\n    });\n  },\n\n  /**\n   * Adds an media to occurrence and sets the medias's parent to this.\n   * @param media\n   */\n  addMedia(mediaObj) {\n    if (!mediaObj) return;\n    mediaObj.setParent(this);\n    this.media.add(mediaObj);\n  },\n\n  /**\n   * Returns child media.\n   * @param index\n   * @returns {*}\n   */\n  getMedia(index = 0) {\n    return this.media.at(index);\n  },\n\n  // overwrite if you want to validate before saving remotely\n  validate(attributes, options = {}) {\n    if (options.remote) {\n      return this.validateRemote(attributes, options);\n    }\n    return null;\n  },\n\n  validateRemote(attributes) {\n    const attrs = _.extend({}, this.attributes, attributes);\n    const media = {};\n\n    const modelErrors = {};\n\n    // location\n    if (!attrs.taxon) {\n      modelErrors.taxon = \"can't be blank\";\n    }\n\n    // media\n    if (this.media.length) {\n      this.media.each(mediaModel => {\n        const errors = mediaModel.validateRemote();\n        if (errors) {\n          const mediaID = mediaModel.cid;\n          media[mediaID] = errors;\n        }\n      });\n    }\n\n    const errors = {};\n    if (!_.isEmpty(media)) {\n      errors.media = media;\n    }\n    if (!_.isEmpty(modelErrors)) {\n      errors.attributes = modelErrors;\n    }\n\n    if (!_.isEmpty(errors)) {\n      return errors;\n    }\n\n    return null;\n  },\n\n  toJSON() {\n    let media;\n    if (!this.media) {\n      media = [];\n      console.warn('toJSON media missing');\n    } else {\n      media = this.media.toJSON();\n    }\n    const data = {\n      id: this.id,\n      cid: this.cid,\n      metadata: this.metadata,\n      attributes: this.attributes,\n      media,\n    };\n    return data;\n  },\n\n  /**\n   * Returns an object with attributes and their values\n   * mapped for warehouse submission.\n   *\n   * @returns {*}\n   */\n  _getSubmission(options = {}) {\n    const that = this;\n    const occKeys = typeof this.keys === 'function' ? this.keys() : this.keys;\n    const keys = $.extend(true, Occurrence.keys, occKeys); // warehouse keys/values to transform\n    const media = [...this.media.models]; // all media within this and child models\n\n    const submission = {\n      id: this.id,\n      external_key: this.cid,\n      fields: {},\n      media: [],\n    };\n\n    if (this.metadata.training || options.training) {\n      submission.training = this.metadata.training || options.training;\n    }\n\n    if (this.metadata.release_status || options.release_status) {\n      submission.release_status =\n        this.metadata.release_status || options.release_status;\n    }\n\n    if (this.metadata.record_status || options.record_status) {\n      submission.record_status =\n        this.metadata.record_status || options.record_status;\n    }\n\n    if (this.metadata.sensitive || options.sensitive) {\n      submission.sensitive = this.metadata.sensitive || options.sensitive;\n    }\n\n    if (this.metadata.confidential || options.confidential) {\n      submission.confidential =\n        this.metadata.confidential || options.confidential;\n    }\n\n    if (this.metadata.sensitivity_precision || options.sensitivity_precision) {\n      submission.sensitivity_precision =\n        this.metadata.sensitivity_precision || options.sensitivity_precision;\n    }\n\n    // transform attributes\n    Object.keys(this.attributes).forEach(attr => {\n      // no need to send attributes with no values\n      let value = that.attributes[attr];\n      if (!value) return;\n\n      if (!keys[attr]) {\n        if (attr !== 'email') {\n          console.warn(`Indicia: no such key: ${attr}`);\n        }\n        submission.fields[attr] = value;\n        return;\n      }\n\n      const warehouseAttr = keys[attr].id || attr;\n\n      // check if has values to choose from\n      if (keys[attr].values) {\n        if (typeof keys[attr].values === 'function') {\n          // get a value from a function\n          value = keys[attr].values(value, submission, that);\n        } else if (_.isArray(value)) {\n          // the attribute has multiple values\n          value = value.map(v => keys[attr].values[v]);\n        } else {\n          value = keys[attr].values[value];\n        }\n      }\n\n      // don't need to send null or undefined\n      if (value) {\n        submission.fields[warehouseAttr] = value;\n      }\n    });\n\n    // transform sub models\n    // media does not return any media-models only JSON data about them\n    // media files will be attached separately\n    const [mediaSubmission] = this.media._getSubmission();\n    submission.media = mediaSubmission;\n\n    return [submission, media];\n  },\n\n  /**\n   * Synchronises the model.\n   * @param method\n   * @param model\n   * @param options\n   */\n  sync(method, model, options = {}) {\n    if (options.remote) {\n      return this._syncRemote(method, model, options);\n    }\n\n    return Promise.reject(new Error('Local sync is not possible yet.'));\n  },\n\n  /**\n   * Syncs the record to the remote server.\n   * Returns on success: model, response, options\n   */\n  _syncRemote() {\n    return Promise.reject(new Error('Remote sync is not possible yet.'));\n  },\n\n  _getDefaultMetadata(options) {\n    const metadata =\n      typeof this.metadata === 'function' ? this.metadata() : this.metadata;\n\n    options.metadata = options.metadata || {};\n\n    const today = new Date();\n    const defaults = {\n      training: options.training,\n\n      created_on: today,\n      updated_on: today,\n\n      synced_on: null, // set when fully initialized only\n      server_on: null, // updated on server\n    };\n\n    return $.extend(true, defaults, metadata, options.metadata);\n  },\n});\n\n_.extend(Occurrence.prototype, syncHelpers);\n\n/**\n * Warehouse attributes and their values.\n */\nOccurrence.keys = {\n  taxon: {\n    id: 'taxa_taxon_list_id',\n  },\n  comment: { id: 'comment' },\n};\n\nexport { Occurrence as default };\n","/** *********************************************************************\n * SAMPLE\n *\n * Refers to the event in which the sightings were observed, in other\n * words it describes the place, date, people, environmental conditions etc.\n * Within a sample, you can have zero or more occurrences which refer to each\n * species sighted as part of the sample.\n **********************************************************************/\nimport Backbone from 'backbone';\nimport $ from 'jquery';\nimport _ from 'underscore';\nimport {\n  SYNCHRONISING,\n  CONFLICT,\n  CHANGED_LOCALLY,\n  CHANGED_SERVER,\n  SYNCED,\n  SERVER,\n  LOCAL,\n  API_BASE,\n  API_VER,\n  API_SAMPLES_PATH,\n} from './constants';\nimport helpers from './helpers';\nimport syncHelpers from './sync_helpers';\nimport Media from './Media';\nimport Store from './Store';\nimport Occurrence from './Occurrence';\nimport Collection from './Collection';\n\nconst Sample = Backbone.Model.extend({\n  Media,\n  Occurrence,\n\n  host_url: null, // must be set up for remote sync\n  api_key: null, // must be set up for remote sync\n\n  user: null, // must be set up for remote sync\n  password: null, // must be set up for remote sync\n\n  constructor(attributes = {}, options = {}) {\n    this.id = options.id; // remote ID\n    this.cid = options.cid || helpers.getNewUUID();\n    this.setParent(options.parent || this.parent);\n\n    this.store = options.store || this.store || new Store();\n    this.keys = options.keys || this.keys; // warehouse attribute keys\n\n    if (options.Media) this.Media = options.Media;\n    if (options.Occurrence) this.Occurrence = options.Occurrence;\n    if (options.onSend) this.onSend = options.onSend;\n\n    // remote host defaults\n    this.host_url = options.host_url || this.host_url;\n    this.api_key = options.api_key || this.api_key;\n    this.user = options.user || this.user;\n    this.password = options.password || this.password;\n\n    // attrs\n    this.attributes = {};\n    const defaultAttrs = {\n      date: new Date(),\n      location_type: 'latlon',\n    };\n    let attrs = _.extend(defaultAttrs, attributes);\n    if (options.collection) this.collection = options.collection;\n    if (options.parse) attrs = this.parse(attrs, options) || {};\n    attrs = _.defaults({}, attrs, _.result(this, 'defaults'));\n    this.set(attrs, options);\n    this.changed = {};\n\n    // metadata\n    this.metadata = this._getDefaultMetadata(options);\n\n    this.remote = {}; // for synchronisation state\n\n    // initialise sub models\n    this.occurrences = this._parseModels(options.occurrences, this.Occurrence);\n    this.samples = this._parseModels(options.samples, this.constructor);\n    this.media = this._parseModels(options.media, this.Media);\n\n    this.initialize.apply(this, arguments); // eslint-disable-line\n  },\n\n  /**\n   * Sets parent.\n   * @param parent\n   */\n  setParent(parent) {\n    if (!parent) return;\n\n    const that = this;\n    this.parent = parent;\n    this.parent.on('destroy', () => {\n      that.destroy({ noSave: true });\n    });\n  },\n\n  /**\n   * Adds a subsample to the sample and sets the samples's parent to this.\n   * @param sample\n   */\n  addSample(sample) {\n    if (!sample) return;\n    sample.setParent(this);\n\n    this.samples.push(sample);\n  },\n\n  /**\n   * Adds an occurrence to sample and sets the occurrence's sample to this.\n   * @param occurrence\n   */\n  addOccurrence(occurrence) {\n    if (!occurrence) return;\n    occurrence.setParent(this);\n\n    this.occurrences.push(occurrence);\n  },\n\n  /**\n   * Adds an media to occurrence and sets the media's occurrence to this.\n   * @param media\n   */\n  addMedia(media) {\n    if (!media) return;\n    media.setParent(this);\n    this.media.add(media);\n  },\n\n  // overwrite if you want to validate before saving locally\n  validate(attributes, options = {}) {\n    if (options.remote) {\n      return this.validateRemote(attributes, options);\n    }\n    return null;\n  },\n\n  validateRemote(attributes) {\n    const attrs = _.extend({}, this.attributes, attributes);\n\n    const modelErrors = {};\n    const samples = {};\n    const occurrences = {};\n    const media = {};\n\n    // location\n    if (!attrs.location) {\n      modelErrors.location = \"can't be blank\";\n    }\n\n    // location type\n    if (!attrs.location_type) {\n      modelErrors.location_type = \"can't be blank\";\n    }\n\n    // date\n    if (!attrs.date) {\n      modelErrors.date = \"can't be blank\";\n    } else {\n      const date = new Date(attrs.date);\n      if (date === 'Invalid Date' || date > new Date()) {\n        modelErrors.date =\n          new Date(date) > new Date() ? 'future date' : 'invalid';\n      }\n    }\n\n    // check if has any indirect occurrences\n    if (!this.samples.length && !this.occurrences.length) {\n      modelErrors.occurrences = 'no occurrences';\n    }\n\n    // samples\n    if (this.samples.length) {\n      this.samples.each(model => {\n        const errors = model.validateRemote();\n        if (errors) {\n          const sampleID = model.cid;\n          samples[sampleID] = errors;\n        }\n      });\n    }\n\n    // occurrences\n    if (this.occurrences.length) {\n      this.occurrences.each(occurrence => {\n        const errors = occurrence.validateRemote();\n        if (errors) {\n          const occurrenceID = occurrence.cid;\n          occurrences[occurrenceID] = errors;\n        }\n      });\n    }\n\n    // media\n    if (this.media.length) {\n      this.media.each(mediaModel => {\n        const errors = mediaModel.validateRemote();\n        if (errors) {\n          const mediaID = mediaModel.cid;\n          media[mediaID] = errors;\n        }\n      });\n    }\n\n    const errors = {};\n    if (!_.isEmpty(media)) {\n      errors.media = media;\n    }\n    if (!_.isEmpty(occurrences)) {\n      errors.occurrences = occurrences;\n    }\n    if (!_.isEmpty(samples)) {\n      errors.samples = samples;\n    }\n    if (!_.isEmpty(modelErrors)) {\n      errors.attributes = modelErrors;\n    }\n\n    if (!_.isEmpty(errors)) {\n      return errors;\n    }\n\n    return null;\n  },\n\n  /**\n   * Synchronises the model.\n   * @param method\n   * @param model\n   * @param options\n   */\n  sync(method, model, options = {}) {\n    if (options.remote) {\n      return this._syncRemote(method, model, options);\n    }\n\n    if (!this.store) {\n      return Promise.reject(\n        new Error('Trying to locally sync a model without a store')\n      );\n    }\n\n    try {\n      this.trigger('request', model, null, options);\n    } catch (e) {\n      /* continue on listener error */\n    }\n    return this.store.sync(method, model, options);\n  },\n\n  /**\n   * Syncs the record to the remote server.\n   * Returns on success: model, response, options\n   */\n  _syncRemote(method, model, options) {\n    // Ensure that we have a URL.\n    if (!this.host_url) {\n      return Promise.reject(\n        new Error('A \"url\" property or function must be specified')\n      );\n    }\n\n    model.remote.synchronising = true;\n\n    // model.trigger('request', model, xhr, options);\n    switch (method) {\n      case 'create':\n        return this._create(model, options)\n          .then(val => {\n            model.remote.synchronising = false;\n            return val;\n          })\n          .catch(err => {\n            model.remote.synchronising = false;\n            return Promise.reject(err);\n          });\n\n      case 'update':\n        // todo\n        model.remote.synchronising = false;\n        return Promise.reject(\n          new Error('Updating the model is not possible yet.')\n        );\n\n      case 'read':\n        // todo\n        model.remote.synchronising = false;\n        return Promise.reject(\n          new Error('Reading the model is not possible yet.')\n        );\n\n      case 'delete':\n        // todo\n        model.remote.synchronising = false;\n        return Promise.reject(\n          new Error('Deleting the model is not possible yet.')\n        );\n\n      default:\n        model.remote.synchronising = false;\n        return Promise.reject(\n          new Error(`No such remote sync option: ${method}`)\n        );\n    }\n  },\n\n  /**\n   * Posts a record to remote server.\n   * @param model\n   * @param options\n   */\n  _create(model, options) {\n    const that = this;\n\n    // async call to get the form data\n    return that\n      ._getModelData(model)\n      .then(data => that._ajaxModel(data, model, options));\n  },\n\n  _ajaxModel(data, model, options) {\n    const that = this;\n    const promise = new Promise((fulfill, reject) => {\n      // get timeout\n      let timeout = options.timeout || that.timeout || 30000; // 30s\n      timeout = typeof timeout === 'function' ? timeout() : timeout;\n\n      const url = that.host_url + API_BASE + API_VER + API_SAMPLES_PATH;\n      const xhr = (options.xhr = Backbone.ajax({\n        url,\n        type: 'POST',\n        data,\n        headers: {\n          authorization: that.getUserAuth(),\n          'x-api-key': that.api_key,\n        },\n        processData: false,\n        contentType: false,\n        timeout,\n      }));\n\n      xhr.done(responseData => fulfill(responseData));\n\n      xhr.fail((jqXHR, textStatus, errorThrown) => {\n        if (jqXHR.status === 409) {\n          // duplicate occurred - this fixes only occurrence duplicates!\n          // todo: remove once this is sorted\n          const responseData = {\n            data: {\n              id: null,\n              external_key: null,\n              occurrences: [],\n            },\n          };\n\n          jqXHR.responseJSON.errors.forEach(error => {\n            responseData.data.id = error.sample_id;\n            responseData.data.external_key = error.sample_external_key;\n            responseData.data.occurrences.push({\n              id: error.id,\n              external_key: error.external_key,\n            });\n          });\n\n          fulfill(responseData);\n          return;\n        }\n\n        let error = new Error(errorThrown);\n        if (jqXHR.responseJSON && jqXHR.responseJSON.errors) {\n          const message = jqXHR.responseJSON.errors.reduce(\n            (name, err) => `${name}${err.title}\\n`,\n            ''\n          );\n          error = new Error(message);\n        }\n        try {\n          model.trigger('error:remote', error);\n        } catch (e) {\n          /* continue on listener error */\n        }\n        reject(error);\n      });\n\n      try {\n        model.trigger('request:remote', model, xhr, options);\n      } catch (e) {\n        /* continue on listener error */\n      }\n    });\n\n    return promise;\n  },\n\n  _remoteCreateParse(model, responseData) {\n    // get new ids\n    const remoteIDs = {};\n\n    // recursively extracts ids from collection of response models\n    function getIDs(data) {\n      remoteIDs[data.external_key] = data.id;\n      if (data.samples) {\n        data.samples.forEach(subModel => getIDs(subModel));\n      }\n      if (data.occurrences) {\n        data.occurrences.forEach(subModel => getIDs(subModel));\n      }\n      // Images don't store external_keys yet.\n      // if (data.media) data.media.forEach(subModel => getIDs(subModel));\n    }\n\n    getIDs(responseData);\n\n    this._setNewRemoteID(model, remoteIDs);\n  },\n\n  /**\n   * Sets new server IDs to the models.\n   */\n  _setNewRemoteID(model, remoteIDs) {\n    // set new remote ID\n    const remoteID = remoteIDs[model.cid];\n    if (remoteID) {\n      model.id = remoteID;\n    }\n\n    // do that for all submodels\n    if (model.samples) {\n      model.samples.forEach(subModel =>\n        this._setNewRemoteID(subModel, remoteIDs)\n      );\n    }\n    if (model.occurrences) {\n      model.occurrences.forEach(subModel =>\n        this._setNewRemoteID(subModel, remoteIDs)\n      );\n    }\n    if (model.media) {\n      model.media.forEach(subModel =>\n        this._setNewRemoteID(subModel, remoteIDs)\n      );\n    }\n  },\n\n  _getModelData(model) {\n    if (!model) {\n      throw new Error('No model passed to _getModelData.');\n    }\n\n    const that = this;\n\n    // get submission model and all the media\n    const [submission, media] = model._getSubmission();\n    submission.type = 'samples';\n\n    // allow updating the submission data if onSend function is set\n    if (this.onSend) {\n      return this.onSend(submission, media).then(data => {\n        const [newSubmission, newMedia] = data;\n        return that._normaliseModelData(newSubmission, newMedia);\n      });\n    }\n\n    return this._normaliseModelData(submission, media);\n  },\n\n  /**\n   * Creates a stringified JSON representation of the model or a FormData object.\n   * If the media is present then it creates a FormData so that the record\n   * could be submitted in one call.\n   */\n  _normaliseModelData(submission, media) {\n    // stringify submission\n    const stringSubmission = JSON.stringify({\n      data: submission,\n    });\n\n    // with media send form-data in one request\n    if (media.length) {\n      const formData = new FormData(); // for submission\n      formData.append('submission', stringSubmission);\n      // append media\n      return this._mediaAppend(media, formData).then(() =>\n        Promise.resolve(formData)\n      );\n    }\n\n    return Promise.resolve(stringSubmission);\n  },\n\n  _mediaAppend(media, formData) {\n    const mediaProcesses = [];\n    media.forEach(mediaModel => {\n      const imagePromise = new Promise(_fulfill => {\n        const url = mediaModel.getURL();\n        const type = mediaModel.get('type');\n        const name = mediaModel.cid;\n\n        function onSuccess(err, img, dataURI, blob) {\n          // can provide both image/jpeg and jpeg\n          let extension = type;\n          let mediaType = type;\n          if (type.match(/image.*/)) {\n            extension = type.split('/')[1];\n          } else {\n            mediaType = `image/${mediaType}`;\n          }\n          if (!blob) {\n            blob = helpers.dataURItoBlob(dataURI, mediaType);\n          }\n\n          formData.append(name, blob, `${name}.${extension}`);\n          _fulfill();\n        }\n\n        if (!helpers.isDataURL(url)) {\n          // load image\n          const xhr = new XMLHttpRequest();\n          xhr.open('GET', url, true);\n          xhr.responseType = 'blob';\n          xhr.onload = () => {\n            onSuccess(null, null, null, xhr.response);\n          };\n          // todo check error case\n\n          xhr.send();\n        } else {\n          onSuccess(null, null, url);\n        }\n      });\n      mediaProcesses.push(imagePromise);\n    });\n\n    return Promise.all(mediaProcesses);\n  },\n\n  /**\n   * Returns an object with attributes and their values\n   * mapped for warehouse submission.\n   *\n   * @returns {*}\n   */\n  _getSubmission(options = {}) {\n    const that = this;\n    const sampleKeys =\n      typeof this.keys === 'function' ? this.keys() : this.keys;\n    const keys = $.extend(true, Sample.keys, sampleKeys); // warehouse keys/values to transform\n    let media = [...this.media.models]; // all media within this and child models\n\n    const submission = {\n      id: this.id,\n      external_key: this.cid,\n      survey_id: this.metadata.survey_id,\n      input_form: this.metadata.input_form,\n      fields: {},\n      media: [],\n    };\n\n    // transform attributes\n    Object.keys(this.attributes).forEach(attr => {\n      // no need to send attributes with no values\n      let value = that.attributes[attr];\n      if (!value) return;\n\n      if (!keys[attr]) {\n        if (attr !== 'email') {\n          console.warn(`Indicia: no such key: ${attr}`);\n        }\n        submission.fields[attr] = value;\n        return;\n      }\n\n      const warehouseAttr = keys[attr].id || attr;\n\n      // check if has values to choose from\n      if (keys[attr].values) {\n        if (typeof keys[attr].values === 'function') {\n          // get a value from a function\n          value = keys[attr].values(value, submission, that);\n        } else if (_.isArray(value)) {\n          // the attribute has multiple values\n          value = value.map(v => keys[attr].values[v]);\n        } else {\n          value = keys[attr].values[value];\n        }\n      }\n\n      // don't need to send null or undefined\n      if (value) {\n        submission.fields[warehouseAttr] = value;\n      }\n    });\n\n    const sampleOptions = _.extend({}, options);\n    this.metadata.training && (sampleOptions.training = this.metadata.training);\n    this.metadata.release_status &&\n      (sampleOptions.release_status = this.metadata.release_status);\n    this.metadata.record_status &&\n      (sampleOptions.record_status = this.metadata.record_status);\n    this.metadata.sensitive &&\n      (sampleOptions.sensitive = this.metadata.sensitive);\n    this.metadata.confidential &&\n      (sampleOptions.confidential = this.metadata.confidential);\n    this.metadata.sensitivity_precision &&\n      (sampleOptions.sensitivity_precision = this.metadata.sensitivity_precision);\n\n    // transform sub models\n    // occurrences\n    const [occurrences, occurrencesMedia] = this.occurrences._getSubmission(\n      sampleOptions\n    );\n    submission.occurrences = occurrences;\n    media = media.concat(occurrencesMedia);\n\n    // samples\n    const [samples, samplesMedia] = this.samples._getSubmission(sampleOptions);\n    submission.samples = samples;\n    media = media.concat(samplesMedia);\n\n    // media - does not return any media-models only JSON data about them\n    const [mediaSubmission] = this.media._getSubmission(sampleOptions);\n    submission.media = mediaSubmission;\n\n    return [submission, media];\n  },\n\n  toJSON() {\n    let occurrences;\n    if (!this.occurrences) {\n      occurrences = [];\n      console.warn('toJSON occurrences missing');\n    } else {\n      occurrences = this.occurrences.toJSON();\n    }\n\n    let samples;\n    if (!this.samples) {\n      samples = [];\n      console.warn('toJSON samples missing');\n    } else {\n      samples = this.samples.toJSON();\n    }\n\n    let media;\n    if (!this.media) {\n      media = [];\n      console.warn('toJSON media missing');\n    } else {\n      media = this.media.toJSON();\n    }\n\n    const data = {\n      id: this.id,\n      cid: this.cid,\n      metadata: this.metadata,\n      attributes: this.attributes,\n      occurrences,\n      samples,\n      media,\n    };\n\n    return data;\n  },\n\n  /**\n   * Sync statuses:\n   * synchronising, synced, remote, server, changed_remotely, changed_server, conflict\n   */\n  getSyncStatus() {\n    const meta = this.metadata;\n    // on server\n    if (this.remote.synchronising) {\n      return SYNCHRONISING;\n    }\n\n    if (this.id >= 0) {\n      // fully initialized\n      if (meta.synced_on) {\n        // changed_remotely\n        if (meta.synced_on < meta.updated_on) {\n          // changed_server - conflict!\n          if (meta.synced_on < meta.server_on) {\n            return CONFLICT;\n          }\n          return CHANGED_LOCALLY;\n          // changed_server\n        } else if (meta.synced_on < meta.server_on) {\n          return CHANGED_SERVER;\n        }\n        return SYNCED;\n\n        // partially initialized - we know the record exists on\n        // server but has not yet been downloaded\n      }\n      return SERVER;\n\n      // local only\n    }\n    return LOCAL;\n  },\n\n  /**\n   * Returns child occurrence.\n   * @param index\n   * @returns {*}\n   */\n  getOccurrence(index = 0) {\n    return this.occurrences.at(index);\n  },\n\n  /**\n   * Returns child sample.\n   * @param index\n   * @returns {*}\n   */\n  getSample(index = 0) {\n    return this.samples.at(index);\n  },\n\n  /**\n   * Returns child media.\n   * @param index\n   * @returns {*}\n   */\n  getMedia(index = 0) {\n    return this.media.at(index);\n  },\n\n  getUserAuth() {\n    if (!this.user || !this.password) {\n      return null;\n    }\n\n    const user = typeof this.user === 'function' ? this.user() : this.user;\n    const password =\n      typeof this.password === 'function' ? this.password() : this.password;\n    const basicAuth = btoa(`${user}:${password}`);\n\n    return `Basic  ${basicAuth}`;\n  },\n\n  _parseModels(models, Model) {\n    if (!models) {\n      // init empty samples collection\n      return new Collection([], { model: Model });\n    }\n\n    const that = this;\n\n    const modelsArray = [];\n    _.each(models, model => {\n      if (model instanceof Model) {\n        model.setParent(that);\n        modelsArray.push(model);\n      } else {\n        const modelOptions = _.extend(model, { parent: that });\n        const newModel = new Model(model.attributes, modelOptions);\n        modelsArray.push(newModel);\n      }\n    });\n\n    return new Collection(modelsArray, { model: Model });\n  },\n\n  isNew() {\n    return !this.id;\n  },\n\n  // Fetch the model from the server, merging the response with the model's\n  // local attributes. Any changed attributes will trigger a \"change\" event.\n  fetch(options) {\n    const model = this;\n    const promise = new Promise((fulfill, reject) => {\n      options = _.extend({ parse: true }, options);\n      return this.sync('read', this, options)\n        .then(resp => {\n          // set the returned model's data\n          model.id = resp.id;\n          model.metadata = resp.metadata;\n          if (!model.set(resp.attributes, options)) return false;\n\n          // initialise sub models\n          model.occurrences = model._parseModels(\n            resp.occurrences,\n            model.Occurrence\n          );\n          model.samples = model._parseModels(resp.samples, Sample);\n          model.media = model._parseModels(resp.media, model.Media);\n\n          try {\n            model.trigger('sync', model, resp, options);\n          } catch (e) {\n            /* continue on listener error */\n          }\n\n          fulfill(model);\n          return null;\n        })\n        .catch(reject);\n    });\n\n    return promise;\n  },\n\n  _getDefaultMetadata(options) {\n    const metadata =\n      typeof this.metadata === 'function' ? this.metadata() : this.metadata;\n    const today = new Date();\n    const defaults = {\n      survey_id: options.survey_id,\n      input_form: options.input_form,\n\n      created_on: today,\n      updated_on: today,\n\n      synced_on: null, // set when fully initialized only\n      server_on: null, // updated on server\n    };\n\n    return $.extend(true, defaults, metadata, options.metadata);\n  },\n});\n\n_.extend(Sample.prototype, syncHelpers);\n\n/**\n * Warehouse attributes and their values.\n */\nSample.keys = {\n  date: { id: 'date' },\n  sample_method_id: { id: 'sample_method_id' },\n  location: { id: 'entered_sref' },\n  location_type: {\n    id: 'entered_sref_system',\n    values: {\n      british: 'OSGB', // for British National Grid\n      irish: 'OSIE', // for Irish Grid\n      channel: 'utm30ed50', // for Channel Islands Grid\n      latlon: 4326, // for Latitude and Longitude in decimal form (WGS84 datum)\n    },\n  },\n  form: { id: 'input_form' },\n  group: { id: 'group_id' },\n  comment: { id: 'comment' },\n};\n\nexport { Sample as default };\n","import $ from 'jquery';\nimport { API_BASE, API_VER, API_REPORTS_PATH } from './constants';\n\nclass Report {\n  constructor(options = {}) {\n    this.host_url = options.host_url || this.host_url;\n    this.user = options.user || this.user;\n    this.password = options.password || this.password;\n    this.report = options.report || this.report;\n\n    this.api_key = options.api_key || this.api_key;\n    this.params = options.params || this.params;\n    this.timeout = options.timeout || 180000; // 3 min;\n  }\n\n  run(params) {\n    const that = this;\n    const promise = new Promise((fulfill, reject) => {\n      const url =\n        this.host_url + API_BASE + API_VER + API_REPORTS_PATH + this.report;\n\n      params = $.extend(params || that.params, { api_key: that.api_key });\n      $.get({\n        url,\n        data: params,\n        timeout: that.timeout,\n        headers: {\n          authorization: that.getUserAuth(),\n          'x-api-key': that.api_key,\n        },\n        success: fulfill,\n        error: (jqXHR, textStatus, errorThrown) => {\n          let error = new Error(errorThrown);\n          if (jqXHR.responseJSON && jqXHR.responseJSON.errors) {\n            const message = jqXHR.responseJSON.errors.reduce(\n              (name, err) => `${name}${err.title}\\n`,\n              ''\n            );\n            error = new Error(message);\n          }\n          reject(error);\n        },\n      });\n    });\n\n    return promise;\n  }\n\n  getUserAuth() {\n    if (!this.user || !this.password) {\n      return null;\n    }\n\n    const user = typeof this.user === 'function' ? this.user() : this.user;\n    const password =\n      typeof this.password === 'function' ? this.password() : this.password;\n    const basicAuth = btoa(`${user}:${password}`);\n\n    return `Basic  ${basicAuth}`;\n  }\n}\n\nexport default Report;\n","import _ from 'underscore';\nimport Store from './Store';\nimport Collection from './Collection';\nimport Sample from './Sample';\nimport Occurrence from './Occurrence';\nimport Media from './Media';\nimport Report from './Report';\nimport * as CONST from './constants';\n\nconst Indicia = {\n  /* global LIB_VERSION */\n  VERSION: LIB_VERSION, // replaced by build\n\n  Store,\n  Collection,\n\n  Sample,\n  Occurrence,\n  Media,\n  Report,\n};\n\n_.extend(Indicia, CONST);\n\nexport { Indicia as default };\n"],"names":["Store","options","that","localForage","ready","Promise","resolve","reject","customDriversPromise","_resolve","driverOrder","_typeof","LocalForage","defineDriver","then","dbConfig","name","storeName","version","drivers","_getDriverOrder","DB","createInstance","setDriver","catch","method","model","cid","find","findAll","create","update","destroy","Error","_callWhenReady","Backbone","Collection","models","length","toWait","_","each","collectionModel","store","push","save","all","id","key","setItem","toJSON","getItem","data","iterate","value","clone","removeItem","func","bind","map","driver","INDEXEDDB","WEBSQL","LOCALSTORAGE","_driver","console","error","extend","constructor","prototype","apply","arguments","comparator","a","metadata","created_on","size","collection","sync","fetch","parse","resp","reset","trigger","e","remote","_syncRemote","synchronising","_getSubmission","submission","media","forEach","modelSubmission","modelMedia","concat","_prepareModel","_isModel","attrs","attributes","validationError","API_BASE","API_VER","API_SAMPLES_PATH","API_REPORTS_PATH","SYNCHRONISING","SYNCED","LOCAL","SERVER","CHANGED_LOCALLY","CHANGED_SERVER","CONFLICT","getNewUUID","replace","c","r","Math","random","v","toString","dataURItoBlob","dataURI","fileType","binary","atob","split","array","i","charCodeAt","Blob","Uint8Array","type","isDataURL","string","normalized","regex","match","isPlainObject","obj","class2type","types","toLowerCase","String","call","isWindow","nodeType","hasOwn","undefined","isEmptyObject","formatDate","dateToFormat","date","now","Date","day","month","reg","regDash","regDashInv","dateArray","test","window","parseInt","getDate","slice","getMonth","getFullYear","helpers","val","validate","wait","set","_validate","isNew","patch","parent","err","_remoteCreateParse","timeNow","server_on","updated_on","synced_on","promise","fulfill","finalise","stopListening","noSave","THUMBNAIL_WIDTH","THUMBNAIL_HEIGHT","Media","Model","setParent","defaults","result","changed","initialize","getURL","get","on","resize","MAX_WIDTH","MAX_HEIGHT","args","image","addThumbnail","re","width","getDataURI","height","validateRemote","errors","isEmpty","syncHelpers","file","FileReader","reader","onload","event","target","Image","src","readAsDataURL","maxWidth","maxHeight","res","canvas","document","createElement","getContext","drawImage","toDataURL","Occurrence","keys","_getDefaultMetadata","mediaArray","modelOptions","addMedia","mediaObj","add","getMedia","index","at","modelErrors","taxon","mediaModel","mediaID","warn","occKeys","$","external_key","fields","training","release_status","record_status","sensitive","confidential","sensitivity_precision","Object","attr","warehouseAttr","values","isArray","mediaSubmission","today","comment","Sample","host_url","api_key","user","password","onSend","defaultAttrs","location_type","occurrences","_parseModels","samples","addSample","sample","addOccurrence","occurrence","location","sampleID","occurrenceID","_create","_getModelData","_ajaxModel","timeout","url","xhr","ajax","headers","authorization","getUserAuth","processData","contentType","done","responseData","fail","jqXHR","textStatus","errorThrown","status","responseJSON","sample_id","sample_external_key","message","reduce","title","remoteIDs","getIDs","subModel","_setNewRemoteID","remoteID","newSubmission","newMedia","_normaliseModelData","stringSubmission","JSON","stringify","formData","FormData","append","_mediaAppend","mediaProcesses","imagePromise","_fulfill","onSuccess","img","blob","extension","mediaType","XMLHttpRequest","open","responseType","response","send","sampleKeys","survey_id","input_form","sampleOptions","occurrencesMedia","samplesMedia","getSyncStatus","meta","getOccurrence","getSample","basicAuth","btoa","modelsArray","newModel","sample_method_id","british","irish","channel","latlon","form","group","Report","report","params","success","Indicia","VERSION","CONST"],"mappings":"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"}