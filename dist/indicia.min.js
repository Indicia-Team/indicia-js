/*!
 * @indicia-js/core 5.1.1
 * Indicia JavaScript SDK.
 * https://github.com/Indicia-Team/indicia-js
 * Author undefined
 * Released under the GNU GPL v3 license.
 * http://www.gnu.org/licenses/gpl.html
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Indicia={})}(this,(function(t){"use strict";var e=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var r=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}};var n=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)};var i=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var a=function(t){return r(t)||n(t)||i()};function o(t,e){return t(e={exports:{}},e.exports),e.exports}var s=o((function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),o=new x(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return j()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=b(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var h=c(t,e,r);if("normal"===h.type){if(n=r.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(n="completed",r.method="throw",r.arg=h.arg)}}}(t,r,o),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var u={};function h(){}function f(){}function l(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(_([])));m&&m!==e&&r.call(m,i)&&(d=m);var y=l.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function g(t){var e;this._invoke=function(n,i){function a(){return new Promise((function(e,a){!function e(n,i,a,o){var s=c(t[n],t,i);if("throw"!==s.type){var u=s.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?Promise.resolve(h.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(n,i,e,a)}))}return e=e?e.then(a,a):a()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,u;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return f.prototype=y.constructor=l,l.constructor=f,l[o]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},v(g.prototype),g.prototype[a]=function(){return this},t.AsyncIterator=g,t.async=function(e,r,n,i){var a=new g(s(e,r,n,i));return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=_,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));var c=function(t){if(Array.isArray(t))return t};var u=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}};var h=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var f=function(t,e){return c(t)||u(t,e)||h()};var l=function(t,e){if(null==t)return{};var r,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(i[r]=t[r]);return i};var d=function(t,e){if(null==t)return{};var r,n,i=l(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i};var p=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=function(t,e,r){return e&&m(t.prototype,e),r&&m(t,r),t};function v(t,e,r,n,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}var g=function(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){v(a,n,i,o,s,"next",t)}function s(t){v(a,n,i,o,s,"throw",t)}o(void 0)}))}},b=Object.freeze({__proto__:null,API_BASE:"api/",API_VER:"v1",API_SAMPLES_PATH:"/samples"});o((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(r)}t.exports=e}));function w(t,e){return O.apply(this,arguments)}function O(){return(O=g(s.mark((function t(e,r){var n,i,a,o,c,u=arguments;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:8e4,i=new Promise((function(t,e){return setTimeout((function(){return e(new Error("timeout"))}),n)})),t.next=4,Promise.race([fetch(e,r),i]);case 4:return a=t.sent,t.next=7,a.json();case 7:if(t.t0=t.sent,t.t0){t.next=10;break}t.t0={};case 10:if(o=t.t0,a.ok){t.next=16;break}throw(c=new Error(a.statusText)).status=a.status,o.errors||(c.errors=o.errors),c;case 16:return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function _(t,e){if((n=t)&&n.toString().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i)){var r=function(t,e){for(var r=atob(t.split(",")[1]),n=[],i=0;i<r.length;i++)n.push(r.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:e})}(t,e);return Promise.resolve(r)}var n;return new Promise((function(e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){var t=r.response;e(t)},r.send()}))}function j(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function k(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?j(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,t),e(this,"cid",x()),e(this,"id",null),e(this,"attrs",{}),e(this,"metadata",{created_on:new Date}),e(this,"keys",{}),this.id=r.id,this.cid=r.cid||this.cid,this.attrs=k({},this.attrs,{},r.attrs,{},r.attributes),this.metadata=k({},this.metadata,{},r.metadata)}return y(t,[{key:"getURL",value:function(){return this.attrs.data}},{key:"resize",value:function(e,r){var n=this,i=this;return new Promise((function(a,o){t.resize(n.getURL(),n.attrs.type,e,r).then((function(t){var e=f(t,2),r=e[0],n=e[1];i.attrs.data=n,a([r,n])})).catch(o)}))}},{key:"addThumbnail",value:function(){var e=this,r=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],this),n=new Promise((function(n,i){/^data:/i.test(e.getURL())?t.resize(e.getURL(),e.attrs.type,100,100).then((function(t){var e=f(t,2)[1];r.attrs.thumbnail=e,n()})).catch(i):t.getDataURI(e.getURL(),{width:100,height:100}).then((function(t){var e=f(t,1);r.attrs.thumbnail=e[0],n()})).catch(i)}));return n}},{key:"toJSON",value:function(){return{id:this.id,cid:this.cid,metadata:this.metadata,attrs:this.attrs}}},{key:"getSubmission",value:function(){return[{id:this.id,name:this.cid}]}}],[{key:"getDataURI",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Promise((function(n,i){if("string"==typeof e){var a=e.replace(/.*\.([a-z]+)$/i,"$1");return"jpg"===a&&(a="jpeg"),void t.resize(e,a,r.width,r.height).then((function(t){var e=f(t,2),r=e[0],i=e[1];n([i,a,r.width,r.height])}))}if(window.FileReader){var o=new FileReader;o.onload=function(i){if(r.width||r.height)t.resize(i.target.result,e.type,r.width,r.height).then((function(t){var r=f(t,2),i=r[0],a=r[1];n([a,e.type,i.width,i.height])}));else{var a=new window.Image;a.onload=function(){var t=e.type.replace(/.*\/([a-z]+)$/i,"$1");n([i.target.result,t,a.width,a.height])},a.src=i.target.result}},o.readAsDataURL(e)}else i(new Error("No File Reader"))}));return n}},{key:"resize",value:function(t,e,r,n){return new Promise((function(i){var a=new window.Image;a.onload=function(){var t=a.width,o=a.height,s=null;t/=s=t>o?t/(r||t):o/(n||o),o/=s;var c=document.createElement("canvas");c.width=t,c.height=o,c.getContext("2d").drawImage(a,0,0,t,o),i([a,c.toDataURL(e)])},a.src=t}))}},{key:"fromJSON",value:function(t){return new this(t)}}]),t}();function E(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?E(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function L(){var t=new Date;return{training:null,created_on:t,updated_on:t,synced_on:null,server_on:null}}var N=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,t),e(this,"cid",x()),e(this,"id",null),e(this,"attrs",{}),e(this,"metadata",L()),e(this,"media",[]),e(this,"keys",t.keys),this.id=r.id,this.cid=r.cid||this.cid,this.attrs=P({},this.attrs,{},r.attrs,{},r.attributes),this.metadata=P({},this.metadata,{},r.metadata)}return y(t,[{key:"toJSON",value:function(){var t;return this.media?t=this.media.map((function(t){return t.toJSON()})):(t=[],console.warn("toJSON media missing")),{id:this.id,cid:this.cid,metadata:this.metadata,attrs:this.attrs,media:t}}},{key:"getSubmission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this,n="function"==typeof this.keys?this.keys():this.keys,i=P({},t.keys,{},n),o=a(this.media),s={id:this.id,external_key:this.cid,fields:{},media:[]};function c(t,e){var n=i[t].values;return n?"function"==typeof n?n(e,s,r):n instanceof Array?n.find((function(t){return t.value===e})).id:e instanceof Array?e.map((function(t){return n[t]})):n[e]:e}function u(t){var e=r.attrs[t];if(e){if(!i[t])return"email"!==t&&console.warn("Indicia: no such key: ".concat(t)),void(s.fields[t]=e);var n=i[t].id||t;(e=c(t,e))&&(s.fields[n]=e)}}(this.metadata.training||e.training)&&(s.training=this.metadata.training||e.training),(this.metadata.release_status||e.release_status)&&(s.release_status=this.metadata.release_status||e.release_status),(this.metadata.record_status||e.record_status)&&(s.record_status=this.metadata.record_status||e.record_status),(this.metadata.sensitive||e.sensitive)&&(s.sensitive=this.metadata.sensitive||e.sensitive),(this.metadata.confidential||e.confidential)&&(s.confidential=this.metadata.confidential||e.confidential),(this.metadata.sensitivity_precision||e.sensitivity_precision)&&(s.sensitivity_precision=this.metadata.sensitivity_precision||e.sensitivity_precision),Object.keys(this.attrs).forEach(u);var h=[];return this.media.forEach((function(t){var e=t.getSubmission(),r=f(e,1)[0];h.push(r)})),s.media=h,[s,o]}}],[{key:"fromJSON",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,r=t.media,n=d(t,["media"]),i=new this(n);return r.forEach((function(t){return i.media.push(e.fromJSON(t))})),i}}]),t}();function D(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?D(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function R(){var t=new Date;return{survey_id:null,input_form:null,created_on:t,updated_on:t,synced_on:null,server_on:null}}function I(t){var e={data:{id:null,external_key:null,occurrences:[]}};return t.forEach((function(t){e.data.id=t.sample_id,e.data.external_key=t.sample_external_key,e.data.occurrences.push({id:t.id,external_key:t.external_key})})),e}function J(t,e){return z.apply(this,arguments)}function z(){return(z=g(s.mark((function t(e,r){var n,i,a,o,c,u,h,l;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.attrs.type,i=n,a=n,n.match(/image.*/)?(o=n.split("/"),c=f(o,2),i=c[1]):a="image/".concat(a),u=e.getURL(),t.next=7,_(u,a);case 7:h=t.sent,l=e.cid,r.append(l,h,"".concat(l,".").concat(i));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t,e){return U.apply(this,arguments)}function U(){return(U=g(s.mark((function t(e,r){var n,i,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=JSON.stringify({data:e}),r.length){t.next=3;break}return t.abrupt("return",n);case 3:return(i=new FormData).append("submission",n),a=r.map((function(t){return J(t,i)})),t.next=8,Promise.all(a);case 8:return t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t,e){var r={};!function t(e){r[e.external_key]=e.id,e.samples&&e.samples.forEach((function(e){return t(e)})),e.occurrences&&e.occurrences.forEach((function(e){return t(e)}))}(e),function t(e,r){var n=r[e.cid];n&&(e.id=n),e.samples&&e.samples.forEach((function(e){return t(e,r)})),e.occurrences&&e.occurrences.forEach((function(e){return t(e,r)})),e.media&&e.media.forEach((function(e){return t(e,r)}))}(t,r)}function G(t){if(!t.user||!t.password)return null;var e="function"==typeof t.user?t.user():t.user,r="function"==typeof t.password?t.password():t.password,n=btoa("".concat(e,":").concat(r));return"Basic  ".concat(n)}e(N,"keys",{taxon:{id:"taxa_taxon_list_id"},comment:{id:"comment"}});var M=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,t),e(this,"cid",x()),e(this,"id",null),e(this,"attrs",{date:new Date,location_type:"latlon"}),e(this,"metadata",R()),e(this,"media",[]),e(this,"occurrences",[]),e(this,"samples",[]),e(this,"keys",t.keys),e(this,"remote",{host_url:null,api_key:null,timeout:3e4,user:null,password:null,synchronising:!1}),this.id=r.id,this.cid=r.cid||x(),this.attrs=A({},this.attrs,{},r.attrs,{},r.attributes),this.metadata=A({},this.metadata,{},r.metadata)}var r,n;return y(t,null,[{key:"fromJSON",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=t.samples,a=t.occurrences,o=t.media,s=d(t,["samples","occurrences","media"]),c=new this(s);return i.forEach((function(t){return c.samples.push(r.fromJSON(t))})),a.forEach((function(t){return c.occurrences.push(e.fromJSON(t))})),o.forEach((function(t){return c.media.push(n.fromJSON(t))})),c}}]),y(t,[{key:"toJSON",value:function(){var t,e,r;return this.occurrences?t=this.occurrences.map((function(t){return t.toJSON()})):(t=[],console.warn("toJSON occurrences missing")),this.samples?e=this.samples.map((function(t){return t.toJSON()})):(e=[],console.warn("toJSON samples missing")),this.media?r=this.media.map((function(t){return t.toJSON()})):(r=[],console.warn("toJSON media missing")),{id:this.id,cid:this.cid,metadata:this.metadata,attrs:this.attrs,occurrences:t,samples:e,media:r}}},{key:"saveRemote",value:(n=g(s.mark((function t(){var e,r,n,i,a,o,c;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.remote.host_url&&this.remote.api_key){t.next=2;break}return t.abrupt("return",Promise.reject(new Error('A "remote" property is not configured.')));case 2:return t.prev=2,this.remote.synchronising=!0,e=this.getSubmission(),r=f(e,2),n=r[0],i=r[1],n.type="samples",t.next=8,T(n,i);case 8:return a=t.sent,t.next=11,this._createRemote(a);case 11:return o=t.sent,this.remote.synchronising=!1,F(this,o.data),c=new Date,this.metadata.server_on=c,this.metadata.updated_on=c,this.metadata.synced_on=c,t.abrupt("return",this);case 21:throw t.prev=21,t.t0=t.catch(2),this.remote.synchronising=!1,t.t0;case 25:case"end":return t.stop()}}),t,this,[[2,21]])}))),function(){return n.apply(this,arguments)})},{key:"getSubmission",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this,n="function"==typeof this.keys?this.keys():this.keys,i=A({},t.keys,{},n),o=a(this.media),s={id:this.id,external_key:this.cid,survey_id:this.metadata.survey_id,input_form:this.metadata.input_form,fields:{},media:[]};function c(t,e){var n=i[t].values;return n?"function"==typeof n?n(e,s,r):n instanceof Array?n.find((function(t){return t.value===e})).id:e instanceof Array?e.map((function(t){return n[t]})):n[e]:e}function u(t){var e=r.attrs[t];if(e){if(!i[t])return"email"!==t&&console.warn("Indicia: no such key: ".concat(t)),void(s.fields[t]=e);var n=i[t].id||t;(e=c(t,e))&&(s.fields[n]=e)}}Object.keys(this.attrs).forEach(u);var h=A({},e);this.metadata.training&&(h.training=this.metadata.training),this.metadata.release_status&&(h.release_status=this.metadata.release_status),this.metadata.record_status&&(h.record_status=this.metadata.record_status),this.metadata.sensitive&&(h.sensitive=this.metadata.sensitive),this.metadata.confidential&&(h.confidential=this.metadata.confidential),this.metadata.sensitivity_precision&&(h.sensitivity_precision=this.metadata.sensitivity_precision);var l=[],d=[];this.occurrences.forEach((function(t){var e=t.getSubmission(h),r=f(e,2),n=r[0],i=r[1];l.push(n),d=d.concat(i)})),s.occurrences=l,o=o.concat(d);var p=[],m=[];this.samples.forEach((function(t){var e=t.getSubmission(h),r=f(e,2),n=r[0],i=r[1];p.push(n),m=m.concat(i)})),s.samples=p,o=o.concat(m);var y=[];return this.media.forEach((function(t){var e=t.getSubmission(),r=f(e,1)[0];y.push(r)})),s.media=y,[s,o]}},{key:"_createRemote",value:(r=g(s.mark((function t(e){var r,n,i,a,o,c;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.remote.host_url+"api/v1/samples",n={method:"POST",headers:{authorization:G(this.remote),"x-api-key":this.remote.api_key},body:e},t.prev=2,t.next=5,w(r,n);case 5:return t.abrupt("return",t.sent);case 8:if(t.prev=8,t.t0=t.catch(2),i=t.t0.status,a=t.t0.errors,o=void 0===a?[]:a,409!==i){t.next=13;break}return t.abrupt("return",I(o));case 13:if(!o){t.next=16;break}throw c=o.reduce((function(t,e){return"".concat(t).concat(e.title,"\n")}),""),new Error(c);case 16:throw t.t0;case 17:case"end":return t.stop()}}),t,this,[[2,8]])}))),function(t){return r.apply(this,arguments)})}]),t}();function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}e(M,"keys",{date:{id:"date"},sample_method_id:{id:"sample_method_id"},location:{id:"entered_sref"},location_type:{id:"entered_sref_system",values:{british:"OSGB",irish:"OSIE",channel:"utm30ed50",latlon:4326}},form:{id:"input_form"},group:{id:"group_id"},comment:{id:"comment"}});var B=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?$(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({VERSION:"5.1.1",Sample:M,Occurrence:N,Media:S},b);t.Media=S,t.Occurrence=N,t.Sample=M,t.default=B,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=indicia.min.js.map
